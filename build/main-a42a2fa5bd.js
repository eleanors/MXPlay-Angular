angular.module("Music",["restangular","music.state","music.auth","music.nav","music.tools","music.config","music.filter","music.directive","music.service","music.controller","music.access"]),angular.module("Music").controller("layoutCtrl",["$scope","$state",function(t,e){t.logout=function(){e.go("access.signin")}}]).controller("ViewDetailCtrl",["$scope","$stateParams","Restangular",function(t,e,a){e.goodsId&&a.one("music",e.goodsId+".json").get().then(function(t){},function(){})}]).controller("signupCtrl",["$scope","$state","authService",function(t,e,a){t.$on("$destroy",function(){}),t.signup=function(){}}]),angular.module("Music").run(["$templateCache",function(t){t.put("common/layout/header.html",'<div class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><a ui-sref="app.home" class="navbar-brand">MXPlay</a><div class="btn navbar-toggle" data-toggle="collapse" data-target="#navbarList" aria-controls="navbarList"><span class="sr-only">切换显示</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div></div><div id="navbarList" class="navbar-collapse collapse"><top-nav></top-nav><ul class="nav navbar-nav navbar-right"><li><a ui-sref="access.signin" ng-click="">登录</a></li><li><a ui-sref="access.signup" ng-click="">注册</a></li><li class="active"><a href="javascript:;" ng-click="logout()">退出</a></li></ul></div></div></div>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("access.html",'<div class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><a ui-sref="app.home" class="navbar-brand">MXPlay</a><div class="btn navbar-toggle" data-toggle="collapse" data-target="#navbarList" aria-controls="navbarList"><span class="sr-only">切换显示</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div></div><div id="navbarList" class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a ui-sref="app.home">发现音乐</a></li><li><a ui-sref="#">最新上架</a></li></ul></div></div></div>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("common/layout/footer.html",'<footer class="footer"><div class="container"><p class="text-muted text-right">copy right 2016~2040...</p></div></footer>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("MXPlay/layout/home.html",'<section class="contrainer-fluid" ng-controller="layoutCtrl"><header class="" data-ng-include="\'common/layout/header.html\'"></header><section data-ui-view="mainer"><aside id="nav" class="col-sm-3 col-md-2 sidebar" onload="loadPage()"><left-nav></left-nav></aside><section id="content" class="col-sm-9 col-md-10 col-sm-offset-3 col-md-offset-2 main" data-ui-view ng-show="nav_done"></section></section><footer class="footer"><div class="container"><p class="text-muted text-right">copy right 2016~2040...</p></div></footer></section>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("site/ranking.html",'<div class="container"><h4>排行榜.....</h4><div class="jumbtron text-center"><h3>主页</h3><p>暂无内容...</p></div></div>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("site/communite.html",'<div class="container"><h4>社区.....</h4><div class="jumbtron text-center"><h3>主页</h3><p>暂无内容...</p></div></div>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/music/default.html","<div>这里是主界面....</div>")}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/music/listview.html",'<div>音乐列表页...<a ui-sref="app.music.detail({goodsId:100})">Music...</a></div>')}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/music/category.html","<div>音乐分类页...</div>")}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/music/recommend.html","<div>音乐推荐页...</div>")}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/ablum/listview.html","<div>专辑列表页...</div>")}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/ablum/category.html","<div>专辑分类页...</div>")}]),angular.module("Music").run(["$templateCache",function(t){t.put("home/ablum/recommend.html","<div>专辑推荐页...</div>")}]),angular.module("music.access",["ipCookie","music.auth","music.service","music.tools","music.config"]).factory("accessService",["$http","$q","$config","$dialogs",function(t,e,a,i){return{restPasswordDialog:function(){},sendCode:function(){},restPassword:function(){}}}]).controller("signinCtrl",["$scope","$rootScope","$httpApi","$config","$state","$toaster","authService","accessService","ipCookie",function(e,a,i,n,o,l,s,r,c){window.postFlag=!1,e.$on("$destroy",function(){a.loginPage=!1}),e.restPassword=function(){},e.psdisabled=!0,e.$watch("loginData.mobile",function(a){a&&11==a.length&&(e.mobileLoading=!0,i.post(n.api.account.checkMobile,{mobile:a,is_seed:!0}).then(function(t){e.mobileLoading=!1,angular.isDefined(t.password)?(e.psdisabled=!1,e.accountData=t):(l.info("没有找到该用户...."),e.psdisabled=!0)},function(){l.info("没有找到该用户...."),e.psdisabled=!0})["finally"](function(){t.mobileLoading=!1}))}),e.eventformvalidate={submitHandler:function(){e.$apply(function(){e.loginloading=!0;var t={mobile:$("#mobile").val(),password:$("#password").val(),remember:e.loginData.remember||!1},a=angular.extend({},t,{mode:"login",encrypted_password:e.accountData.password});s.login(a).then(function(){l.info("登录成功...."),o.go("app.music.view")},function(){l.info("账号或密码有误....")}).then(function(){e.loginloading=!1})})}}}]).controller("signupCtrl",["$scope","$rootScope","$state","$toaster","authService","httpErrorFilter",function(t,e,a,i,n,o){e.loginPage=!0,t.$on("$destroy",function(){e.loginPage=!0}),t.signup=function(){t.signuploading=!0,n.saveRegistration().then(function(){a.go("app.home")},function(t){o(t,function(){i.info("注册有误...")})}).then(function(){t.signuploading=!1})}}]),!function(t){try{t=angular.module("music.access")}catch(e){t=angular.module("music.access",[])}t.run(["$templateCache",function(t){t.put("access/signin.html",'<header class="header" data-ng-include="\'access.html\'"></header><div class="container" style="margin-top:15px;padding:0;"><div class="col-md-8 hidden-xs"></div><div class="col-md-4"><div class="panel panel-default"><div class="panel-heading"><h4>登录</h4></div><div class="panel-body"><form class="panel-body form-horizontal" form-validator="" formvalidatorconfig="eventformvalidate"> <div class="form-group form-user"><label class="control-label">手机号码：</label><span class="login-ico login-user"></span><input type="text" placeholder="" id="mobile" class="form-control input-lg" data-rule-required="true" name="mobile" ng-model="loginData.mobile"><p ng-show="mobileLoading">验证中...</p></div><div class="form-group form-lock"><label class="control-label">密码：</label><span class="login-ico login-lock"></span><input type="password" placeholder="" class="form-control input-lg" data-rule-required="true" ng-disabled="psdisabled" name="password" id="password" ng-model="loginData.password"></div><div class="checkbox"><label><input type="checkbox" ng-model="loginData.remember">记住我的帐号</label></div><button type="submit" class="btn btn-primary submit-btn" btn-loading="loginloading" loading-text="登录中..." ng-disabled="psdisabled">登录</button></form></div></div></div></div><div toast-container data-ng-include="\'common/layout/footer.html\'"></div>')}])}(),!function(t){try{t=angular.module("music.access")}catch(e){t=angular.module("music.access",[])}t.run(["$templateCache",function(t){t.put("access/signup.html",'<header class="header" data-ng-include="\'access.html\'"></header><div class="container" style="margin-top:15px;padding:0;"><div class="col-md-8 hidden-xs"></div><div class="col-md-4"><div class="panel panel-default"><div class="panel-heading"><strong>注册</strong></div><div class="panel-body"><form class="panel-body" ng-submit="signup()"><div class="form-group"><label class="control-label">邮箱</label><input type="email" class="form-control input-lg" ng-model="entity.email"></div><div class="form-group"><label class="control-label">密码</label><input type="password" class="form-control input-lg" ng-model="entity.password"></div><div class="form-group"><label class="control-label">确认密码</label><input type="password" class="form-control input-lg" ng-model="entity.confirmPassword"></div><div class="checkbox"><label><input type="checkbox" checked="checked"> 我已阅读并接受<a href="javascript:;">MXPlay</a></label></div><button type="submit" class="btn btn-primary" btn-loading="signuploading" loading-text="注册中...">注册</button><div class="line line-dashed"></div><p class="text-muted text-center"><small>已有注册账号, 可直接登录?</small></p><a href="javasrcript:;" ui-sref="access.signin" class="btn btn-default btn-block">登录</a></form></div></div></div></div><div toast-container data-ng-include="\'common/layout/footer.html\'"></div>')}])}(),angular.module("music.auth",["restangular","LocalStorage","ipCookie","music.config","music.tools"]).factory("$httpApi",["$http","$q","$timeout","$filter","$config","$rootScope","$injector","$toaster",function(t,e,a,i,n,o,l,s){function r(t){var e={};if(o.locals.userData){var a=o.locals.userData;e.nick=a.nick,e.leaver=a.leaver}return t=angular.extend({},e,t),jQuery.param(t)}function c(t,a,i){if(0==t.data.code)return a.resolve(e.fullResponse?t:t.data);if("103004"==t.data.code){var o=l.get("authService");s.warning("登录超时,请重新登录..."),o.removeAuthData(),window.postFlag=!0}return n.debug&&s.info(t.data.message+"错误码："+t.data.code),a.reject(t)}var u={transformRequest:r,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8",Apiclient:"MXPlay"}};return{get:function(){},post:function(a,n,o){var l=e.defer(),s=angular.extend({},u,o);return window.postFlag?console.log("postFlag...."):t.get(i("apiUrlPrefix")(a),n,s).then(function(t){c(t,l,s)},function(t){c(t,l,s)}),l.promise}}}]).factory("authService",["$q","Restangular","localStorageService","ipCookie","$config","$httpApi","$state","$timeout","$rootScope","$locale",function(t,e,a,i,n,o,l,s,r,c){function u(e){var a=t.defer();return h.expires=e.remember?365:0,o.post(n.api.account.login,e).then(function(t){return m(t),a.resolve(t)},function(t){return a.reject(t)}),a.promise}function d(){o.post(n.api.account.logout,{}).then(function(){i.remove("authorization",h)},function(){i.remove("authorization",h)}),isAuth=!1,l.go("access.signin")}function m(t){i("authorization",t.data,h),v.isAuth=!0,v.userData=t.data}function p(){var t=i("authorization");return t&&(v.userData=t,v.isAuth=!0,v.userRole={}),v}function g(){i.remove("authorization",h),v.isAuth=!1,l.go("access.signin")}function f(t){e.one("auth/register").customPost(t).then(function(t){return m(t),t})}var v={isAuth:!1,token:null,userData:null},h={path:"/",expires:0};return{login:u,logout:d,fillAuthData:p,saveRegistration:f,removeAuthData:g}}]).factory("AuthInterceptorService",["$q","$toaster","$config","$injector","ipCookie",function(t,e,a,i,n){function o(t){t.headers=t.headers||{};var e=n("authorization");return e&&(t.headers.Authorization=e.token,t.headers.Apiclient="MXPlay"),t}function l(n){var o=function(){if(a.debug){i.get("$dialogs");e.warning("地址有误..已被拦截")}else e.info("网络异常...请重试")};200!=n.status&&o(),t.reject(n)}return{request:o,responseError:l}}]),angular.module("music.config",["music.service"]).constant("$config",{host:{domain:"localhost",www:window.location.host+"/api/","static":"static.localhost",api:"/api/"},site:{name:"MXPlay"},api:{account:{login:"access/signin",sendCode:"access/sendCode",checkMobile:"access/checkMobile",checkThirdLogin:"access/checkThirdLogin",logout:"access/signup"},music:{list:"music/list",category:"music/category",recommend:"music/recommend"},ablum:{list:"ablum/list",category:"ablum/category",recommend:"ablum/recommend"}},debug:!1}).run(["$rootScope","$state","$stateParams","$pageTitle","$config","$injector","$toaster","$locale","Restangular","authService",function(t,e,a,i,n,o,l,s,r,c){t.$state=e,t.$stateParams=a,t.$config=n,t.toasterOptions={"position-class":"toast-top-center","time-out":4e3,limit:1},t.$on("$stateChangeStart",function(){}),t.locals=c.fillAuthData()}]).config(["RestangularProvider","$config",function(t,e){t.setBaseUrl(e.host.api)}]).config(["RestangularProvider","$httpProvider","$pageTitleProvider","$config",function(t,e,a,i){t.setBaseUrl(i.host.api),e.interceptors.push("AuthInterceptorService"),a.setDefault("MXPlay")}]),angular.module("music.controller",[]).controller("signinCtrl",[function(){}]),angular.module("music.directive",[]).directive("formValidator",["$timeout",function(t){return{restruct:"A",scope:{formvalidatorconfig:"=",formvalidatorapi:"="},link:function(t,e,a){t.$watch("formvalidatorconfig",function(t){var a={errorClass:"help-block error",submitHandler:function(){}},i=jQuery.extend(!0,a,t);e.validate(i)},!0),t.formvalidatorapi&&(t.formvalidatorapi={validate:function(){e.validate().form},valid:function(){return e.valid()}})}}}]).directive("btnLoading",function(){return{restruct:"AE",scope:{loadingText:"@",btnLoading:"=",ifDisabled:"=?"},link:function(t,e,a){var i=e.html();t.$watch("btnLoading",function(a){return angular.isUndefined(a)?void 0:(t.ifDisabled=angular.isUndefined(t.ifDisabled))?!0:void(t.ifDisabled?e.prop("disabled",a):"@"==t.loadingText?t.loadingText="<i></i>":e.html(a?t.loadingText||"loading...":i))})}}}).directive("loadingContainer",["$rootScope","$parse",function(t,e){return{restruct:"AE",scope:!1,link:function(a,i,n){var o=e(n.overly||"true")(a),l=angular.element('<div class="loading"></div>');l.css({width:"100%",height:"100%",background:"#0af",opacity:.6,position:"absolute",left:0,top:0}),o&&(i.append(l),i.addClass("loading-container")),a.$watch(n.loadingContainer,function(e){t.loading_done=!e})}}}]),angular.module("music.filter",[]).filter("apiUrlPrefix",["$config",function(t){return function(e){return"http://"+t.host.www+e+".json"}}]).filter("httpErrorFilter",[function(){return function(t,e){-1==_.indexOf([401,404,500,502],t.status)&&e()}}]),angular.module("music.nav",[]).controller("LeftCtrl",["$scope",function(t){t.menu=[{title:"音乐主界面",href:"app.music.view",icon:""},{title:"音乐列表",href:"app.music.list",icon:"",submenu:[{title:"最新榜单",href:"app.music.list"},{title:"最新榜单",href:"app.music.list"}]},{title:"音乐分类",href:"app.music.category",icon:""},{title:"音乐推荐",href:"app.music.recommend",icon:""},{title:"专辑列表",href:"app.ablum.listview",icon:""},{title:"专辑分类",href:"app.ablum.category",icon:""},{title:"专辑推荐",href:"app.ablum.recommend",icon:""}]}]).directive("topNav",function(){return{restrict:"EA",replace:!0,templateUrl:"compnents/navbar/topnav.html",link:function(t,e,a){e.on("click","li",function(){angular.element(this).addClass("active").siblings().removeClass("active")})}}}).directive("leftNav",function(){return{restrict:"EA",replace:!0,scope:!0,controller:"LeftCtrl",templateUrl:"compnents/navbar/navar.html"}}).directive("navItem",[function(){return{restrict:"EA",link:function(t,e,a){e.on("click",function(t){var e=$(t.target);e.is("a")||(e=e.closest("a"));var a=e.parent().siblings(".active");a&&a.find("a").toggleClass("active")&&a.toggleClass("active").find("ul:visible").slideUp(500),e.hasClass("active")&&e.next().slideUp(500)||e.next().slideDown(500),e.toggleClass("active").parent().toggleClass("active"),e.next().is("ul")&&t.preventDefault()})}}}]),angular.module("music.nav").run(["$templateCache",function(t){t.put("compnents/navbar/navar.html",'<ul class="nav nav-sidebar"><li ng-repeat="item in menu" ng-class="{active:$index==0}" ui-sref-active="active" ><a ui-sref="{{item.href}}" nav-item>{{item.title}}</a><ul class="nav nav-submenu" ng-if="item.submenu"><li ng-repeat="submenu in item.submenu"><a ui-sref="{{item.href}}">{{submenu.title}}</a></li></ul></li></ul>')}]),angular.module("music.nav").run(["$templateCache",function(t){t.put("compnents/navbar/topnav.html",'<ul class="nav navbar-nav" ><li class="active"><a ui-sref="app.home">发现音乐</a></li><li><a ui-sref="app.mymusic">我的音乐</a></li><li><a ui-sref="app.ranking">排行榜</a></li><li><a ui-sref="app.communite">社区</a></li></ul>')}]),angular.module("music.rest",["restangular","music.config"]).config(["RestangularProvider","$httpProvider","$config","$pageTitleProvider",function(t,e,a,i){t.setBaseUrl(a.host.api),!function(){e.interceptors.push("authInterceptorService"),i.setDefault="MXPlay"}()}]).run(["$rootScope","$state","$stateParams","$pageTitle","$config","$injector","$toaster","$locale","Restangular","authService","toasterConfig",function(t,e,a,i,n,o,l,s,r,c,u){t.$state=e,t.$stateParams=a,t.$config=n,t.toasterOptions={"position-class":"toast-top-center","time-out":4e4},i.set(),!function(){t.$on("$stateChangeStart",function(){}),t.locals=c.fillAuthData()}()}]),angular.module("music.service",[]).provider("$pageTitle",function(){function t(t,a){function i(){return a.document.title}function n(){var t,i;i=arguments.length>0?Array.prototype.slice.call(arguments):e,t=angular.isString(i)?i:[e].concat(i).join(" | "),a.document.title=t}return e?a.document.title=e:e=a.document.title,t.$on("$stateChangeSuccess",function(t,e){var a="";e&&angular.isDefined(e.data)&&(a=e.data.pageTitle||null),a?n(a):n()}),{get:i,set:n}}var e="";this.setDefault=function(t){e=t},this.$get=["$rootScope","$window",t]}),angular.module("music.state",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise(function(t,e){return"app/home"}),t.state("/",{url:"/","abstract":!0}).state("app",{url:"/app","abstract":!0,controller:["$rootScope","$scope",function(t,e){console.log(e),t.nav_done=!0}],templateUrl:"MXPlay/layout/home.html"}).state("app.home",{url:"/home",data:{pageTitle:"发现音乐"},controller:["$rootScope","$scope",function(t,e){}],templateUrl:"home/music/default.html"}).state("access",{url:"/access","abstract":!0,template:"<div ui-view></div>"}).state("access.signin",{url:"/signin",controller:"signinCtrl",data:{pageTitle:"登录"},templateUrl:"access/signin.html"}).state("access.signup",{url:"/signup",data:{pageTitle:"注册"},controller:"signupCtrl",templateUrl:"access/signup.html"}).state("app.music",{url:"/music","abstract":!0,template:"<div ui-view></div>"}).state("app.music.view",{url:"/view",templateUrl:"home/music/default.html"}).state("app.music.list",{url:"/listview",templateUrl:"home/music/listview.html"}).state("app.music.category",{url:"/category",templateUrl:"home/music/category.html"}).state("app.music.recommend",{url:"/recommend",templateUrl:"home/music/recommend.html"}).state("app.music.detail",{url:"/detail/{goodsId:int}",controller:"ViewDetailCtrl",templateUrl:"home/music/recommend.html"}).state("app.ablum",{url:"/ablum","abstract":!0,template:"<div ui-view></div>"}).state("app.ablum.listview",{url:"/listview",templateUrl:"home/ablum/listview.html"}).state("app.ablum.category",{url:"/category",templateUrl:"home/ablum/category.html"}).state("app.ablum.recommend",{url:"/recommend/{articleId:int}",templateUrl:"home/ablum/recommend.html"}).state("app.mymusic",{url:"/mymusic",data:{pageTitle:"我的音乐"},views:{"mainer@app":{templateUrl:"view/music.index.html"}}}).state("app.ranking",{url:"/ranking",data:{pageTitle:"音乐排行榜"},views:{"mainer@app":{templateUrl:"site/ranking.html"}}}).state("app.communite",{url:"/communite",data:{pageTitle:"社区"},views:{"mainer@app":{templateUrl:"site/communite.html"}}})}]),angular.module("music.tools",["toaster"]).factory("$toaster",["toaster",function(t){return{success:function(e,a,i,n){t.pop("success","",e,a)},error:function(e,a,i,n){t.pop("error","",e,a)},info:function(e,a,i,n){t.pop("info","",e,a)},wait:function(e,a,i,n){t.pop("wait","",e,a)},warning:function(e,a,i,n){t.pop("warning","",e,a)},clear:function(){t.clear()}}}]).provider("dialogs",function(){this.$get=[function(){return{alert:function(){},notify:function(){}}}]}).factory("$dialogs",["dialogs",function(t){return{alert:function(){},confim:function(){},wait:function(){},create:function(){}}}]);